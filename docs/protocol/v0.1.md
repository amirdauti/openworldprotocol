# OWP Protocol v0.1 (draft)

This is a draft protocol spec for OWP — The Open World Protocol. It is intentionally minimal and will evolve.

## Design goals

- Direct client → host connections (no relay by default)
- Versioned handshake + capability negotiation
- Chunk streaming + entity replication
- Clear trust boundary: host-only admin; remote clients cannot trigger generation

## Identity primitives (draft)

- **World ID**: deterministic ID derived from `(host_pubkey, world_name, created_at)` or a UUID
- **World authority keypair**: generated locally by the host server; used to sign manifests and registry updates
- **Player identity**: initially local-only (username + client key); wallet auth can be added later

## Address format (draft)

Connect string:

```
owp://<ip_or_dns>:<port>?world=<world_id>&mint=<token_mint>&pubkey=<world_pubkey>
```

## Transport (draft)

MVP options:
- TCP (simple)
- QUIC (preferred long-term for NAT traversal characteristics + built-in encryption patterns)

Encryption:
- If using QUIC, use the session security model provided by the stack
- Otherwise use app-level encryption (e.g., Noise/libsodium) in a future version

## Ports (draft)

- `GAME_PORT`: primary protocol connection (TCP/QUIC)
- Optional `ASSET_PORT`: secondary HTTP endpoint for large assets (optional)

## Message framing (draft)

For v0.1, OWP uses **length-prefixed JSON frames**:

- Frame header: `u32` big-endian payload length (bytes)
- Frame payload: UTF-8 JSON bytes
- Max frame length: 4 MiB (implementation limit)

All messages include:
- `type` (snake_case)
- `protocol_version` (string, currently `"0.1"`)
- `request_id` (UUID string)

## Core message types (minimum)

Handshake:
- `hello` → client announces version and (optionally) requested `world_id`
- `welcome` → server confirms version, world id, token mint, capabilities, optional MOTD

Example `hello` payload:

```json
{
  "type": "hello",
  "protocol_version": "0.1",
  "request_id": "00000000-0000-0000-0000-000000000000",
  "world_id": "00000000-0000-0000-0000-000000000000",
  "client_name": "owp-client-cli"
}
```

Example `welcome` payload:

```json
{
  "type": "welcome",
  "protocol_version": "0.1",
  "request_id": "00000000-0000-0000-0000-000000000000",
  "world_id": "00000000-0000-0000-0000-000000000000",
  "token_mint": "So11111111111111111111111111111111111111112",
  "motd": "Welcome to OWP",
  "capabilities": ["handshake"]
}
```

World metadata:
- `WORLD_MANIFEST` → server sends manifest hash + metadata pointers

Streaming:
- `CHUNK_REQUEST` / `CHUNK_RESPONSE`
- `ENTITY_SNAPSHOT` / `ENTITY_DELTA`

Simulation:
- `PLAYER_INPUT`
- `SERVER_TICK`

UX:
- `CHAT`

## World manifest format (draft)

Versioned JSON manifest stored in the world workspace, e.g. `manifest/world.manifest.json`:

- `world_id`
- `world_authority_pubkey`
- `token_mint` and `dbc_pool` (if enabled)
- `metadata` (name, description, tags)
- `assets` (asset registry + hashes)
- `generation` (provider + run ids + timestamps)

## Compatibility rules

- Clients and servers must reject unknown major versions.
- Minor versions may add optional fields; unknown fields must be ignored.
