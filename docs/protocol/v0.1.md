# OWP Protocol v0.1 (draft)

This is a draft protocol spec for OWP — The Open World Protocol. It is intentionally minimal and will evolve.

## Design goals

- Direct client → host connections (no relay by default)
- Versioned handshake + capability negotiation
- Chunk streaming + entity replication
- Clear trust boundary: host-only admin; remote clients cannot trigger generation

## Identity primitives (draft)

- **World ID**: deterministic ID derived from `(host_pubkey, world_name, created_at)` or a UUID
- **World authority keypair**: generated locally by the host server; used to sign manifests and registry updates
- **Player identity**: initially local-only (username + client key); wallet auth can be added later

## Address format (draft)

Connect string:

```
owp://<ip_or_dns>:<port>?world=<world_id>&mint=<token_mint>&pubkey=<world_pubkey>
```

## Transport (draft)

MVP options:
- TCP (simple)
- QUIC (preferred long-term for NAT traversal characteristics + built-in encryption patterns)

Encryption:
- If using QUIC, use the session security model provided by the stack
- Otherwise use app-level encryption (e.g., Noise/libsodium) in a future version

## Ports (draft)

- `GAME_PORT`: primary protocol connection (TCP/QUIC)
- Optional `ASSET_PORT`: secondary HTTP endpoint for large assets (optional)

## Message framing (draft)

For v0.1, choose one:
- length-prefixed binary frames (recommended)
- newline-delimited JSON for early prototyping only

All messages must include:
- `protocol_version`
- `message_type`
- `request_id` (for request/response patterns)

## Core message types (minimum)

Handshake:
- `HELLO` → client announces version, client capabilities, requested world id
- `WELCOME` → server confirms version, world id, token mint, capabilities, optional MOTD

World metadata:
- `WORLD_MANIFEST` → server sends manifest hash + metadata pointers

Streaming:
- `CHUNK_REQUEST` / `CHUNK_RESPONSE`
- `ENTITY_SNAPSHOT` / `ENTITY_DELTA`

Simulation:
- `PLAYER_INPUT`
- `SERVER_TICK`

UX:
- `CHAT`

## World manifest format (draft)

Versioned JSON manifest stored in the world workspace, e.g. `manifest/world.manifest.json`:

- `world_id`
- `world_authority_pubkey`
- `token_mint` and `dbc_pool` (if enabled)
- `metadata` (name, description, tags)
- `assets` (asset registry + hashes)
- `generation` (provider + run ids + timestamps)

## Compatibility rules

- Clients and servers must reject unknown major versions.
- Minor versions may add optional fields; unknown fields must be ignored.

